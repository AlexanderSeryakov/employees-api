# employees-api

![Static Badge](https://img.shields.io/badge/fastapi-0.104.0-rgb(77%2C%20163%2C%20144))
![Static Badge](https://img.shields.io/badge/pydantic-2.4.2-rgb(176%2C%2035%2C%2073))
![Static Badge](https://img.shields.io/badge/mongodb-rgb(74%2C%2091%2C%20161))
![Static Badge](https://img.shields.io/badge/beanie-1.21.1-rgb(74%2C%2031%2C%20061))


### Тестовое задание в компанию Plarin.

---

### Stack:

- FastAPI
- MongoDB
- Beanie

----

### Запуск проекта

```
make runserver
```

### Для работы с API нужно перейти по адресу

``
http://127.0.0.1:8000/api/docs
``

### API для выбора сотрудников по критериям:

`GET /api/v1/employees/`

### Для выборки сотрудников из общего списка доступны фильтры по следующим полям:

- Имя сотрудника - фильтрация будет вестись по всем именам начинающимся на указанную строку
- email сотрудника - фильтрация по всем адресам электронной почты сотрудников 
- Название компании - фильтрация по всем названиям компаний, которые начинаются на указанную строку
- Название должности - фильтрация по должности
- Пол - принимает 2 значения `female` и `male`, вернёт всех сотрудников с заданным полом
- Возраст - фильтр по всем сотрудникам, возраст которых равен указанному или ниже
- Уровень оплаты - целое число / десятичное число(максимум 2 знака после запятой `100.25`). Фильтра вернёт всех сотрудников уровень оплаты которых ниже указанного
- Параметры limit и skip определяют сколько всего записей будет выбрано и с какой записи пойдёт выборка. По умолчанию имеют значения `10` и `0` соответственно
- Порядок(order) - поле может принимать 6 различных значений для сортировки конечного набора отфильтрованных сотрудников. Возможные вариации порядка: `-name` `name` `age` `-age` `salary` `-salary`. По умолчанию будет использователя `name`.

Пример запроса на выборку всех сотрудников компании `Plarin` мужского пола, от 40 лет и младше с выводом результата в порядке убывания возраста:

```curl
curl -X 'GET' \
  'http://127.0.0.1:8000/api/v1/employees?company=Plarin&gender=male&age=40&limit=10&skip=0&order=-age' \
  -H 'accept: application/json'
```

---

### Добавление определенных сотрудников для теста:

`POST /api/v1/employees/`

Пример запроса:

```curl
curl -X 'POST' \
  'http://127.0.0.1:8000/api/v1/employees' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "name": "John Doe",
  "email": "john@gmail.com",
  "age":23,
  "company": "Plarin",
  "join_date": "2023-10-31T16:14:17.798Z",
  "job_title": "Developer",
  "gender": "male",
  "salary": 2200
}'
```

----

### Загрузка данных из json

Если вам необходимо выгрузить данные из json-файла в базу данных приложения, воспользуйтесь следующей
инструкцией

1) Разместите json-файл в корне проекта
2) Войдите в терминал контейнера, в котором находится mongodb
    ```
   make connect-mongo
   ```
3) Введите следующую команды, где вместо fileName.json укажите имя вашего json-файла
   ```
   mongoimport --db employees_database --collection employees --file home/{fileName.json} --jsonArray
   ```
   Вы также можете указать нужные вам имя базы данных и коллекции.

### По умолчанию я оставил директорию db_data c предустановленным тестовым дампом сотрудников - но в целом делать так не нужно :)